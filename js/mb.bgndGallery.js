function mbBgndGallery(e){return jQuery.mbBgndGallery.buildGallery(e)}var nAgt=navigator.userAgent;if(!jQuery.browser){jQuery.browser={};jQuery.browser.mozilla=!1;jQuery.browser.webkit=!1;jQuery.browser.opera=!1;jQuery.browser.safari=!1;jQuery.browser.chrome=!1;jQuery.browser.msie=!1;jQuery.browser.ua=nAgt;jQuery.browser.name=navigator.appName;jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion);jQuery.browser.majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if(-1!=(verOffset=nAgt.indexOf("Opera")))jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8));else if(-1!=(verOffset=nAgt.indexOf("MSIE")))jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer",jQuery.browser.fullVersion=nAgt.substring(verOffset+5);else if(-1!=nAgt.indexOf("Trident")){jQuery.browser.msie=!0;jQuery.browser.name="Microsoft Internet Explorer";var start=nAgt.indexOf("rv:")+3,end=start+4;jQuery.browser.fullVersion=nAgt.substring(start,end)}else-1!=(verOffset=nAgt.indexOf("Chrome"))?(jQuery.browser.webkit=!0,jQuery.browser.chrome=!0,jQuery.browser.name="Chrome",jQuery.browser.fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(jQuery.browser.webkit=!0,jQuery.browser.safari=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("AppleWebkit"))?(jQuery.browser.webkit=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(jQuery.browser.mozilla=!0,jQuery.browser.name="Firefox",jQuery.browser.fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(jQuery.browser.name=nAgt.substring(nameOffset,verOffset),jQuery.browser.fullVersion=nAgt.substring(verOffset+1),jQuery.browser.name.toLowerCase()==jQuery.browser.name.toUpperCase()&&(jQuery.browser.name=navigator.appName));-1!=(ix=jQuery.browser.fullVersion.indexOf(";"))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix));-1!=(ix=jQuery.browser.fullVersion.indexOf(" "))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix));jQuery.browser.majorVersion=parseInt(""+jQuery.browser.fullVersion,10);isNaN(jQuery.browser.majorVersion)&&(jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10));jQuery.browser.version=jQuery.browser.majorVersion}jQuery.browser.android=/Android/i.test(nAgt);jQuery.browser.blackberry=/BlackBerry/i.test(nAgt);jQuery.browser.ios=/iPhone|iPad|iPod/i.test(nAgt);jQuery.browser.operaMobile=/Opera Mini/i.test(nAgt);jQuery.browser.windowsMobile=/IEMobile/i.test(nAgt);jQuery.browser.mobile=jQuery.browser.android||jQuery.browser.blackberry||jQuery.browser.ios||jQuery.browser.windowsMobile||jQuery.browser.operaMobile;jQuery.fn.CSSAnimate=function(e,t,n,r,i){function s(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function o(e,t){return"string"!==typeof e||e.match(/^[\-0-9\.]+$/)?""+e+t:e}jQuery.support.transition=function(){var e=(document.body||document.documentElement).style;return void 0!==e.transition||void 0!==e.WebkitTransition||void 0!==e.MozTransition||void 0!==e.MsTransition||void 0!==e.OTransition}();return this.each(function(){var u=this,l=jQuery(this);u.id=u.id||"CSSA_"+(new Date).getTime();var c=c||{type:"noEvent"};if(u.CSSAIsRunning&&u.eventType==c.type)u.CSSqueue=function(){l.CSSAnimate(e,t,n,r,i)};else if(u.CSSqueue=null,u.eventType=c.type,0!==l.length&&e){u.CSSAIsRunning=!0;"function"==typeof t&&(i=t,t=jQuery.fx.speeds._default);"function"==typeof n&&(i=n,n=0);"function"==typeof r&&(i=r,r="cubic-bezier(0.65,0.03,0.36,0.72)");if("string"==typeof t)for(var d in jQuery.fx.speeds)if(t==d){t=jQuery.fx.speeds[d];break}else t=jQuery.fx.speeds._default;t||(t=jQuery.fx.speeds._default);if(jQuery.support.transition){c={"default":"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"};c[r]&&(r=c[r]);var v="",y="transitionEnd";jQuery.browser.webkit?(v="-webkit-",y="webkitTransitionEnd"):jQuery.browser.mozilla?(v="-moz-",y="transitionend"):jQuery.browser.opera?(v="-o-",y="otransitionend"):jQuery.browser.msie&&(v="-ms-",y="msTransitionEnd");c=[];for(b in e){d=b;"transform"===d&&(d=v+"transform",e[d]=e[b],delete e[b]);"filter"===d&&(d=v+"filter",e[d]=e[b],delete e[b]);if("transform-origin"===d||"origin"===d)d=v+"transform-origin",e[d]=e[b],delete e[b];"x"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" translateX("+o(e[b],"px")+")",delete e[b]);"y"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" translateY("+o(e[b],"px")+")",delete e[b]);"z"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" translateZ("+o(e[b],"px")+")",delete e[b]);"rotate"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" rotate("+o(e[b],"deg")+")",delete e[b]);"rotateX"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" rotateX("+o(e[b],"deg")+")",delete e[b]);"rotateY"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" rotateY("+o(e[b],"deg")+")",delete e[b]);"rotateZ"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" rotateZ("+o(e[b],"deg")+")",delete e[b]);"scale"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" scale("+o(e[b],"")+")",delete e[b]);"scaleX"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" scaleX("+o(e[b],"")+")",delete e[b]);"scaleY"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" scaleY("+o(e[b],"")+")",delete e[b]);"scaleZ"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" scaleZ("+o(e[b],"")+")",delete e[b]);"skew"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" skew("+o(e[b],"deg")+")",delete e[b]);"skewX"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" skewX("+o(e[b],"deg")+")",delete e[b]);"skewY"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" skewY("+o(e[b],"deg")+")",delete e[b]);"perspective"===d&&(d=v+"transform",e[d]=e[d]||"",e[d]+=" perspective("+o(e[b],"px")+")",delete e[b]);0>c.indexOf(d)&&c.push(s(d))}var b=c.join(","),w=function(){l.off(y+"."+u.id);clearTimeout(u.timeout);l.css(v+"transition","");"function"==typeof i&&i(l);u.called=!0;u.CSSAIsRunning=!1;"function"==typeof u.CSSqueue&&(u.CSSqueue(),u.CSSqueue=null)},E={};$.extend(E,e);E[v+"transition-property"]=b;E[v+"transition-duration"]=t+"ms";E[v+"transition-delay"]=n+"ms";E[v+"transition-style"]="preserve-3d";E[v+"transition-timing-function"]=r;setTimeout(function(){l.one(y+"."+u.id,w);l.css(E)},1);u.timeout=setTimeout(function(){l.called||!i?(l.called=!1,u.CSSAIsRunning=!1):(l.css(v+"transition",""),i(l),u.CSSAIsRunning=!1,"function"==typeof u.CSSqueue&&(u.CSSqueue(),u.CSSqueue=null))},t+n+100)}else{for(var b in e)"transform"===b&&delete e[b],"filter"===b&&delete e[b],"transform-origin"===b&&delete e[b],"auto"===e[b]&&delete e[b];i&&"string"!==typeof i||(i="linear");l.animate(e,t,i)}}})};$.fn.css3=function(e){alert("SSS");return this.each(function(){$(this).CSSAnimate(e,1,0,null)})};(function(e){function t(e){var t=document.createElement("canvas");var n=t.getContext("2d");var r=e.width;var i=e.height;t.width=r;t.height=i;n.drawImage(e,0,0);var s=n.getImageData(0,0,r,i);for(var o=0;o<s.height;o++){for(var u=0;u<s.width;u++){var a=o*4*s.width+u*4;var f=(s.data[a]+s.data[a+1]+s.data[a+2])/3;s.data[a]=f;s.data[a+1]=f;s.data[a+2]=f}}n.putImageData(s,0,0,0,0,s.width,s.height);return t.toDataURL()}e.mbBgndGallery={name:"mb.bgndGallery",author:"Matteo Bicocchi",version:"1.9.0",defaults:{containment:"body",images:[],shuffle:false,controls:null,effect:"fade",filter:null,timer:4e3,effTimer:3e3,raster:false,folderPath:false,autoStart:true,grayScale:false,activateKeyboard:true,preserveTop:false,preserveWidth:false,placeHolder:"",thumbs:{folderPath:"",placeholder:""},onStart:function(){},onChange:function(e,t){},onPause:function(e){},onPlay:function(e){},onNext:function(e){},onPrev:function(e){}},filters:{gray:{moz:"url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'><filter id='grayscale'><feColorMatrix type='matrix' values='0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0'/></filter></svg>#grayscale\")",webkit:"grayscale(100%)",msie:"gray"},halfGray:{moz:"url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'><filter id='grayscale'><feColorMatrix type='saturate' values='0.5'/></filter></svg>#grayscale\")",webkit:"grayscale(50%)",msie:"gray alpha(opacity=50)"}},clear:false,buildGallery:function(t){var n={};e.extend(n,e.mbBgndGallery.defaults,t);n.galleryID=(new Date).getTime();var r=e(n.containment).get(0);r.opt=n;e.mbBgndGallery.el=r;if(r.opt.onStart)r.opt.onStart();r.opt.gallery=e("<div/>").attr({id:"bgndGallery_"+r.opt.galleryID}).addClass("mbBgndGallery");var i=r.opt.containment=="body"?"fixed":"absolute";r.opt.gallery.css({position:i,top:0,let:0,width:"100%",height:"100%",overflow:"hidden"});var s=r.opt.containment;if(s!="body"&&e(s).text().trim()!=""){var o=e("<div/>").css({position:"absolute",minHeight:"100%",minWidth:"100%",zIndex:3});e(s).wrapInner(o);if(e(s).css("position")=="static")e(s).css("position","relative")}if(n.raster){var u=e("<div/>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"url("+n.raster+")",zIndex:1});n.gallery.append(u)}e(s).prepend(n.gallery);if(r.opt.folderPath&&r.opt.images.length==0)r.opt.images=e.loadFromSystem(r.opt.folderPath);if(r.opt.shuffle)r.opt.images=e.shuffle(r.opt.images);var a=r.opt.images.length;var f=0;e.mbBgndGallery.preload(r.opt.images[0],r);r.opt.gallery.on("imageLoaded."+r.opt.galleryID,function(){f++;if(f==a){r.opt.gallery.off("imageLoaded."+r.opt.galleryID);return}e.mbBgndGallery.preload(r.opt.images[f],r)});r.opt.imageCounter=0;e.mbBgndGallery.changePhoto(r.opt.images[r.opt.imageCounter],r);if(!n.autoStart){r.opt.paused=true;e(r.opt.gallery).trigger("paused")}r.opt.gallery.on("imageReady."+r.opt.galleryID,function(){if(r.opt.paused)return;clearTimeout(r.opt.changing);e.mbBgndGallery.play(r)});e(window).on("resize",function(){var t=e("img",r.opt.gallery);e.mbBgndGallery.checkSize(t,r)});var l=r.opt.controls;if(l){$(l).addClass("controls");var c=e(r.opt.controls).find(".counter");c.html(r.opt.imageCounter+1+" / "+r.opt.images.length);e.mbBgndGallery.buildControls(l,r);e(r.opt.containment).on("paused",function(){e(r.opt.controls).find(".play").show();e(r.opt.controls).find(".pause").hide()});e(r.opt.containment).on("play",function(){e(r.opt.controls).find(".play").hide();e(r.opt.controls).find(".pause").show()})}e.mbBgndGallery.buildThumbs(r);return e(r)},normalizeCss:function(t){function s(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function o(e,t){if(typeof e==="string"&&!e.match(/^[\-0-9\.]+$/)){return e}else{return""+e+t}}var n=e.extend(true,{},t);var r="";var i="transitionEnd";if(e.browser.webkit){r="-webkit-";i="webkitTransitionEnd"}else if(e.browser.mozilla){r="-moz-";i="transitionend"}else if(e.browser.opera){r="-o-";i="oTransitionEnd"}else if(e.browser.msie){r="-ms-";i="msTransitionEnd"}for(var u in n){if(u==="transform"){n[r+"transform"]=n[u];delete n[u]}if(u==="transform-origin"){n[r+"transform-origin"]=t[u];delete n[u]}if(u==="filter"){n[r+"filter"]=t[u];delete n[u]}var a="";if(u==="x"){a=r+"transform";n[a]=n[a]||"";n[a]+=" translateX("+o(t[u],"px")+")";delete n[u]}if(u==="y"){a=r+"transform";n[a]=n[a]||"";n[a]+=" translateY("+o(t[u],"px")+")";delete n[u]}if(u==="z"){a=r+"transform";n[a]=n[a]||"";n[a]+=" translateZ("+o(t[u],"px")+")";delete n[u]}if(u==="rotate"){a=r+"transform";n[a]=n[a]||"";n[a]+=" rotate("+o(t[u],"deg")+")";delete n[u]}if(u==="rotateX"){a=r+"transform";n[a]=n[a]||"";n[a]+=" rotateX("+o(t[u],"deg")+")";delete n[u]}if(u==="rotateY"){a=r+"transform";n[a]=n[a]||"";n[a]+=" rotateY("+o(t[u],"deg")+")";delete n[u]}if(u==="rotateZ"){a=r+"transform";n[a]=n[a]||"";n[a]+=" rotateZ("+o(t[u],"deg")+")";delete n[u]}if(u==="scale"){a=r+"transform";n[a]=n[a]||"";n[a]+=" scale("+o(t[u],"")+")";delete n[u]}if(u==="scaleX"){a=r+"transform";n[a]=n[a]||"";n[a]+=" scaleX("+o(t[u],"")+")";delete n[u]}if(u==="scaleY"){a=r+"transform";n[a]=n[a]||"";n[a]+=" scaleY("+o(t[u],"")+")";delete n[u]}if(u==="scaleZ"){a=r+"transform";n[a]=n[a]||"";n[a]+=" scaleZ("+o(t[u],"")+")";delete n[u]}if(u==="skew"){a=r+"transform";n[a]=n[a]||"";n[a]+=" skew("+o(t[u],"deg")+")";delete n[u]}if(u==="skewX"){a=r+"transform";n[a]=n[a]||"";n[a]+=" skewX("+o(t[u],"deg")+")";delete n[u]}if(u==="skewY"){a=r+"transform";n[a]=n[a]||"";n[a]+=" skewY("+o(t[u],"deg")+")";delete n[u]}if(u==="perspective"){a=r+"transform";n[a]=n[a]||"";n[a]+=" perspective("+o(t[u],"px")+")";delete n[u]}}return n},preload:function(t,n){if(e.mbBgndGallery.clear){n.opt.gallery.remove();return}var r=e("<img/>").load(function(){n.opt.gallery.trigger("imageLoaded."+n.opt.galleryID)}).attr("src",t)},checkSize:function(t,n){if(!t)return;if(e.mbBgndGallery.changing)return;if(e.mbBgndGallery.clear){n.opt.gallery.remove();return}return t.each(function(){var t=e(this);var r=t.attr("w");var i=t.attr("h");var s=n.opt.containment=="body"?window:n.opt.containment;var o=r/i;var u=e(s).width()/e(s).height();if(o>=u){t.css("height","100%");t.css("width","auto")}else{t.css("width","100%");t.css("height","auto")}t.css("margin-left",(e(s).width()-t.width())/2);if(!n.opt.preserveTop)t.css("margin-top",(e(s).height()-t.height())/2);if(n.opt.preserveWidth){t.css({width:"100%",height:"auto",left:0,marginLeft:0})}})},changePhoto:function(t,n){if(e.mbBgndGallery.clear){n.opt.gallery.remove();return}e.mbBgndGallery.buildThumbs(n);if(n.opt.thumbs.folderPath.trim().length>0&&n.opt.thumbs.placeholder.trim().length>0){e(".sel",e(n.opt.thumbs.placeholder)).removeClass("sel");e("#mbBgImg_"+n.opt.imageCounter).addClass("sel")}e.mbBgndGallery.changing=true;if(n.opt.onChange)n.opt.onChange(n.opt,n.opt.imageCounter);var r=e("<img/>").hide().load(function(){var t=e(this);var r=e("<div/>").css({position:"absolute",top:-5e3});r.append(t);e("body").append(r);t.attr("w",t.width());t.attr("h",t.height());r.remove();n.opt.effect=typeof n.opt.effect=="object"?n.opt.effect:e.mbBgndGallery.effects[n.opt.effect];e("img",n.opt.gallery).CSSAnimate(n.opt.effect.exit,n.opt.effTimer,0,n.opt.effect.exitTiming,function(e){if(e.length)e.remove()});t.css({position:"absolute"});n.opt.gallery.append(t);e.mbBgndGallery.changing=false;e.mbBgndGallery.checkSize(t,n);var i={top:0,left:0,opacity:1,x:0,y:0,scale:1,rotate:0,skew:0,filter:" blur(0)"};i=e.mbBgndGallery.normalizeCss(i);t.css(e.mbBgndGallery.normalizeCss(n.opt.effect.enter)).show().CSSAnimate(i,n.opt.effTimer,0,n.opt.effect.enterTiming,function(){n.opt.gallery.trigger("imageReady."+n.opt.galleryID)})}).attr("src",t);r.error(function(){var t=e(this);t.attr("src",n.opt.placeHolder)});if(n.opt.grayScale){r.greyScale(n)}var i=e(n.opt.controls).find(".counter");i.html(n.opt.imageCounter+1+" / "+n.opt.images.length)},play:function(t){if(!t)t=this.get(0);clearTimeout(t.opt.changing);var n=e("img",t.opt.gallery).not(":last");n.remove();if(e.mbBgndGallery.clear){t.opt.gallery.remove();return}if(t.opt.onPlay)t.opt.onPlay(t.opt);t.opt.changing=setTimeout(function(){if(t.opt.paused)return;if(t.opt.onNext)t.opt.onNext(t.opt);if(t.opt.imageCounter>=t.opt.images.length-1)t.opt.imageCounter=-1;t.opt.imageCounter++;e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],e(t.opt.containment).get(0))},t.opt.paused?0:t.opt.timer);t.opt.gallery.trigger("play")},pause:function(t){if(!t)t=this.get(0);if(e.mbBgndGallery.clear){t.opt.gallery.remove();return}clearTimeout(t.opt.changing);t.opt.paused=true;t.opt.gallery.trigger("paused");if(t.opt.onPause)t.opt.onPause(t.opt)},next:function(t){if(!t)t=this.get(0);if(e.mbBgndGallery.clear){t.opt.gallery.remove();return}if(t.opt.onNext)t.opt.onNext(t.opt);e.mbBgndGallery.pause(t);if(t.opt.imageCounter==t.opt.images.length-1)t.opt.imageCounter=-1;t.opt.imageCounter++;e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],t);clearTimeout(t.opt.changing)},prev:function(t){if(!t)t=this.get(0);if(e.mbBgndGallery.clear){t.opt.gallery.remove();return}if(t.opt.onPrev)t.opt.onPrev(t.opt);e.mbBgndGallery.pause(t);clearTimeout(t.opt.changing);if(t.opt.imageCounter==0)t.opt.imageCounter=t.opt.images.length;t.opt.imageCounter--;e.mbBgndGallery.changePhoto(t.opt.images[t.opt.imageCounter],t)},loader:{show:function(){},hide:function(){}},keyboard:function(t){e(document).on("keydown.bgndGallery",function(n){switch(n.keyCode){case 32:if(t.opt.paused){e.mbBgndGallery.play(t);t.opt.paused=false}else{t.opt.paused=true;e.mbBgndGallery.pause(t)}n.preventDefault();break;case 39:e.mbBgndGallery.next(t);n.preventDefault();break;case 37:e.mbBgndGallery.prev(t);n.preventDefault();break}})},buildControls:function(t,n){var r=e(t).find(".pause");var i=e(t).find(".play");var s=e(t).find(".next");var o=e(t).find(".prev");var u=e(t).find(".fullscreen");if(e.browser.msie||e.browser.opera||"ontouchstart"in window){u.remove()}if(n.opt.autoStart)i.hide();r.on("click",function(){e.mbBgndGallery.pause(n);e(this).hide();i.show()});i.on("click",function(){if(!n.opt.paused)return;clearTimeout(n.opt.changing);e.mbBgndGallery.play(n);n.opt.paused=false});s.on("click",function(){e.mbBgndGallery.next(n);r.hide();i.show()});o.on("click",function(){e.mbBgndGallery.prev(n);r.hide();i.show()});u.on("click",function(){e.mbBgndGallery.runFullscreen(n)});if(n.opt.activateKeyboard)e.mbBgndGallery.keyboard(n)},changeGallery:function(t){var n=this.get(0);clearTimeout(n.opt.changing);n.opt.gallery.off("imageLoaded."+n.opt.galleryID);e.mbBgndGallery.pause(n);n.opt.gallery.fadeOut();n.opt.images=t;n.opt.imageCounter=-1;var r=n.opt.images;var i=r.length;var s=0;e.mbBgndGallery.preload(r[s],n);n.opt.gallery.on("imageLoaded."+n.opt.galleryID,function(){if(s==i){n.opt.gallery.off("imageLoaded."+n.opt.galleryID);n.opt.gallery.fadeIn();e.mbBgndGallery.play(n);n.opt.paused=false;return}e.mbBgndGallery.preload(r[s],n);s++});if(n.opt.thumbs.folderPath.trim().length>0&&n.opt.thumbs.placeholder.trim().length>0)e.mbBgndGallery.buildThumbs(n)},changeEffect:function(t){e.mbBgndGallery.el.opt.effect=t},runFullscreen:function(t){function i(e,t){var n=["webkit","moz","ms","o",""];var r=0,i,s;while(r<n.length&&!e[i]){i=t;if(n[r]==""){i=i.substr(0,1).toLowerCase()+i.substr(1)}i=n[r]+i;s=typeof e[i];if(s!="undefined"){n=[n[r]];return s=="function"?e[i]():e[i]}r++}}function s(e){i(e,"RequestFullScreen")}function o(){if(i(document,"FullScreen")||i(document,"IsFullScreen")){i(document,"CancelFullScreen")}}if(!t)t=this.get(0);var n=e.browser.mozilla?"mozfullscreenchange":e.browser.webkit?"webkitfullscreenchange":"fullscreenchange";e(document).off(n);e(document).on(n,function(){var n=i(document,"IsFullScreen")||i(document,"FullScreen");if(!n){t.isFullscreen=false;e(".fullScreen_controls").remove();if(!e(t.opt.containment).is("body"))e(t.opt.containment).css({width:t.width,height:t.height,top:t.top,left:t.left,position:t.position});t.opt.gallery.css({background:"transparent"});var r=e("#bgndGallery_"+t.opt.galleryID+" img:first")}e.mbBgndGallery.checkSize(r,t)});if(t.isFullscreen){o()}else{t.isFullscreen=true;if(!e(t.opt.containment).is("body")){t.width=e(t.opt.containment).css("width");t.height=e(t.opt.containment).css("height");t.top=e(t.opt.containment).css("top");t.left=e(t.opt.containment).css("left");t.position=e(t.opt.containment).css("position")}var r=e(t.opt.controls).clone(true).addClass("fullScreen_controls").css({position:"absolute",zIndex:1e3,bottom:20,right:20});r.find(".fullscreen").html("exit");t.opt.gallery.append(r).css({background:"#000"});e(t.opt.containment).CSSAnimate({width:"100%",height:"100%",top:0,left:0,position:"absolute"});s(t.opt.gallery.get(0))}},buildThumbs:function(t){function n(e){return e.split("/").pop()}if(t.opt.thumbs.folderPath.trim().length==0&&t.opt.thumbs.placeholder.trim().length==0)return;e(t.opt.thumbs.placeholder).addClass("thumbnailsContainer");var r=e(t.opt.thumbs.placeholder).children().length||0;if(r!=t.opt.images.length){e(t.opt.thumbs.placeholder).empty();for(var i=0;i<t.opt.images.length;i++){var s=t.opt.thumbs.folderPath+n(t.opt.images[i]);var o=e("<img/>").attr({src:s,id:"mbBgImg_"+i}).click(function(){t.opt.imageCounter=e(this).attr("i")-1;e.mbBgndGallery.next(t);t.opt.paused=true}).attr("i",i).css({opacity:0}).on("load",function(){$(this).fadeTo(1e3,1)});e(t.opt.thumbs.placeholder).append(o)}if(t.opt.thumbs.folderPath.trim().length>0&&t.opt.thumbs.placeholder.trim().length>0){e(".sel",e(t.opt.thumbs.placeholder)).removeClass("sel");e("#mbBgImg_"+t.opt.imageCounter).addClass("sel")}}},addImages:function(t,n,r){var i=this.get(0);for(var s in t){i.opt.images.push(t[s])}if(r)i.opt.images=e.shuffle(i.opt.images);if(n)i.opt.imageCounter=i.opt.images.indexOf(t[0]);e.mbBgndGallery.changePhoto(i.opt.images[i.opt.imageCounter],i);e.mbBgndGallery.buildThumbs(i)},removeImages:function(t){var n=this.get(0);for(var r in t){var i=n.opt.images.indexOf(t[r]);if(i>-1)n.opt.images.splice(i,1)}e.mbBgndGallery.changePhoto(n.opt.images[n.opt.imageCounter],n);e.mbBgndGallery.buildThumbs(n)},applyFilter:function(t){var n=e.mbBgndGallery.filters[t];var r=this.get(0);if(e.browser.msie&&e.browser.version<9){r.style.filter=n["msie"]}else if(e.browser.webkit){r.style["-webkit-filter"]=n["webkit"]}else{r.style.filter=n["moz"]}}};e.fn.mbBgndGalleryPlay=e.mbBgndGallery.play;e.fn.mbBgndGalleryPause=e.mbBgndGallery.pause;e.fn.mbBgndGalleryPrev=e.mbBgndGallery.prev;e.fn.mbBgndGalleryNext=e.mbBgndGallery.next;e.fn.changeGallery=e.mbBgndGallery.changeGallery;e.fn.addImages=e.mbBgndGallery.addImages;e.fn.removeImages=e.mbBgndGallery.removeImages;e.fn.applyFilter=e.mbBgndGallery.applyFilter;e.loadFromSystem=function(t,n){if(!t)return;if(!n)n=["jpg","jpeg","png"];var r=[];e.ajax({url:t,async:false,success:function(i){var s=e(i);var o=s.find("[href]");o.each(function(){for(var i in n){if(e(this).attr("href").indexOf(n[i])>=0)r.push(t+e(this).attr("href"));r=e.unique(r)}});s.remove()}});return r.length!=0?r:false};e.fn.greyScale=function(n){return this.each(function(){if(e.browser.msie&&e.browser.version<9){this.style.filter="progid:DXImageTransform.Microsoft.BasicImage(grayScale=1)"}else if(e.browser.webkit){n.opt.gallery.css("-webkit-filter","grayscale(1) sepia(.4)")}else{this.src=t(this)}})};e.shuffle=function(e){var t=e.slice();var n=t.length;var r=n;while(r--){var i=parseInt(Math.random()*n);var s=t[r];t[r]=t[i];t[i]=s}return t}})(jQuery)